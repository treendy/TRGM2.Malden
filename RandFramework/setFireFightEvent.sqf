//BasicBuildings = ["Land_LightHouse_F","Land_Lighthouse_small_F","Land_Metal_Shed_F","Land_Offices_01_V1_F","Land_Slum_House01_F","Land_Slum_House02_F","Land_Slum_House03_F","Land_Unfinished_Building_01_F","Land_Unfinished_Building_02_F","Land_d_House_Big_01_V1_F","Land_d_House_Big_02_V1_F","Land_d_House_Small_02_V1_F","Land_d_Stone_HouseBig_V1_F","Land_d_Stone_HouseSmall_V1_F","Land_d_Stone_Shed_V1_F","Land_dp_mainFactory_F","Land_i_House_Big_01_V1_F","Land_i_House_Big_01_V2_F","Land_i_House_Big_01_V3_F","Land_i_House_Big_02_V1_F","Land_i_House_Big_02_V2_F","Land_i_House_Big_02_V3_F","Land_i_House_Small_01_V1_F","Land_i_House_Small_01_V2_F","Land_i_House_Small_01_V3_F","Land_i_House_Small_02_V1_F","Land_i_House_Small_02_V2_F","Land_i_House_Small_02_V3_F","Land_i_House_Small_03_V1_F","Land_i_Stone_HouseBig_V1_F","Land_i_Stone_HouseBig_V2_F","Land_i_Stone_HouseBig_V3_F","Land_i_Stone_HouseSmall_V1_F","Land_i_Stone_HouseSmall_V2_F","Land_i_Stone_HouseSmall_V3_F","Land_u_House_Big_01_V1_F","Land_u_House_Big_02_V1_F","Land_u_House_Small_01_V1_F","Land_u_House_Small_02_V1_F","Land_cargo_house_slum_F","Land_jbad_House_1_old","Land_jbad_House_3_old","Land_jbad_House_4_old","Land_jbad_House_6_old","Land_jbad_House_7_old","Land_jbad_House_8_old","Land_jbad_House_9_old","Land_lbad_House_c_1_v2","Land_jbad_House_c_11","Land_jbad_House_c_1","Land_jbad_House_c_2","Land_jbad_House_c_3","Land_jbad_House_c_4","Land_jbad_House_c_5","Land_jbad_House_c_5_v1","Land_jbad_House_c_5_v2","Land_jbad_House_c_5_v3","Land_jbad_House_1","Land_jbad_House_3","Land_jbad_House_5","Land_jbad_House_6","Land_jbad_House_7","Land_jbad_House_8","Land_jbad_House2_basehide","Land_House_C_5_EP1","Land_House_C_5_V1_EP1","Land_House_C_5_V2_EP1","Land_House_C_5_V3_EP1","Land_House_C_12_EP1","Land_House_K_1_EP1","Land_House_K_3_EP1","Land_House_K_5_EP1","Land_House_L_8_EP1","Land_House_K_6_EP1","Land_House_K_7_EP1","Land_House_K_8_EP1","Land_House_L_1_EP1","Land_House_L_4_EP1","Land_House_L_6_EP1","Land_House_L_7_EP1","Land_House_L_8_EP1","Land_jbad_House_1_old","Land_jbad_House_3_old","Land_jbad_House_4_old","Land_jbad_House_6_old","Land_jbad_House_7_old","Land_jbad_House_8_old","Land_jbad_House_9_old","Land_lbad_House_c_1_v2","Land_jbad_House_c_11","Land_jbad_House_c_1","Land_jbad_House_c_2","Land_jbad_House_c_3","Land_jbad_House_c_4","Land_jbad_House_c_5","Land_jbad_House_c_5_v1","Land_jbad_House_c_5_v2","Land_jbad_House_c_5_v3","Land_jbad_House_1","Land_jbad_House_3","Land_jbad_House_5","Land_jbad_House_6","Land_jbad_House_7","Land_jbad_House_8","Land_jbad_House2_basehide","Land_Shed_02_F","Land_House_Small_02_F","Land_House_Small_03_F","Land_House_Small_04_F","Land_House_Small_05_F","Land_House_Small_06_F","Land_House_Big_01_F","Land_House_Big_02_F","Land_House_Big_03_F","Land_House_Big_05_F","Land_Shed_05_F","Land_Shed_06_F","Land_Shed_07_F","Land_Addon_04_F","Land_Shop_City_03_F","Land_Shop_City_05_F","Land_Shop_City_06_F","Land_Shop_City_07_F","Land_House_Big_04_F","Land_House_Native_01_F","Land_House_Native_02_F","Land_House_Native_03_F","Land_House_Native_04_F","Land_House_Native_05_F","Land_House_Native_06_F","Land_blud_hut1","Land_blud_hut2","Land_blud_hut3","Land_blud_hut4","Land_blud_hut5","Land_blud_hut6","Land_blud_hut7","Land_blud_hut8","Land_MBG_GER_RHUS_5","Land_MBG_ATC_Base","Land_MBG_GER_RHUS_2","Land_MBG_GER_HUS_1","Land_MBG_ATC_Segment","Land_MBG_GER_RHUS_1","Land_MBG_GER_HUS_2","Land_MBG_GER_RHUS_3","Land_MBG_GER_RHUS_4","Objects17","Objects18","Objects19","Objects21","Objects22","Objects23","Land_deox_House_A1","Land_deox_House_A2","Land_deox_House_B1","Land_deox_House_B2","Land_deox_House_C1","Land_deox_House_C2","Land_deox_House_D_L1","Land_deox_House_D_L2","Land_deox_House_D_L3","Land_deox_House_D_L4","Land_deox_House_D_M1","Land_deox_House_D_M2","Land_deox_House_D_M3","Land_deox_House_D_M4","Land_deox_House_D_R1","Land_deox_House_D_R3","MBG_Killhouse_3_InEditor","MBG_Killhouse_4_InEditor","MBG_Killhouse_5_InEditor","MBG_Killhouse_2_InEditor","MBG_Killhouse_5_InEditor","MBG_Killhouse_1_InEditor","land_Objects101","land_Objects77","jbad_House_c_1","jbad_House_c_1_v2","jbad_House_c_10","jbad_House_c_11","jbad_House_c_12","jbad_House_c_2","jbad_House_c_3","jbad_House_c_4","jbad_House_c_5","jbad_House_c_5_v1","jbad_House_c_5_v2","jbad_House_c_5_v3","jbad_House_c_9","jbad_dum_istan2","jbad_dum_istan4","Jbad_A_Villa","jbad_House_3_old_h","Jbad_A_BuildingWIP","Jbad_Ind_Workshop01_L","Jbad_A_Stationhouse","Jbad_Mil_Barracks","Jbad_Mil_ControlTower","Jbad_Mil_Guardhouse","Jbad_Mil_House","jbad_mosque_big_addon","jbad_mosque_big_hq","Jbad_A_Mosque_small_1","Land_Jbad_A_Mosque_small_1","Jbad_A_Mosque_small_2"];	
//sCivilian = ["C_man_polo_1_F"];
//FriendlyRadioSounds = ["ambient_radio3","ambient_radio4","ambient_radio5","ambient_radio6","ambient_radio7","ambient_radio9","ambient_radio14","ambient_radio17","ambient_radio19","ambient_radio21","ambient_radio22","ambient_radio23","ambient_radio25","ambient_radio26","ambient_radio27","ambient_radio28","ambient_radio29","ambient_radio30"];
//hint "A";

_posOfAO =  _this select 0;
_eventType = _this select 1; //1=fullWar  2=AOOnly  3=WarzoneOnly 4=warzoneOnlyFullWar

_nearLocations = nearestLocations [_posOfAO, ["NameCity","NameCityCapital","NameVillage"], 1500];

_eventLocationPos = nil;
if (!isNil("ForceWarZoneLoc")) then {
	_eventLocationPos = _posOfAO;
}
else {
	{
		_xLocPos = locationPosition _x;
		if (_xLocPos distance _posOfAO > 950) then {
			_eventLocationPos = _xLocPos;
			//hint str(_xLocPos distance _posOfAO);
		};
	} forEach _nearLocations;


	if (isNil("_eventLocationPos")) then {
		_buildings = nearestObjects [_posOfAO, BasicBuildings, 2000];
		{
			_xLocPos = position _x;
			_bIsClearFromAOCamp = true;
			if (!isNil "AOCampPos") then {
				if (_xLocPos distance AOCampPos < 500) then {
					_bIsClearFromAOCamp = false;
				};
			};
			if (_xLocPos distance _posOfAO > 950 && _bIsClearFromAOCamp) then {
				_eventLocationPos = _xLocPos;
			};
		} forEach _buildings;
	};
};

if (isNil("_eventLocationPos")) then {_eventType == 2};


//sTeamleader
//sRifleman
//sMachineGunMan
//sTank3Tank

//TankorAPC
//FriendlyCheckpointUnits

//TESTTESTeventLocationPos = _eventLocationPos;

WarzonePos = _eventLocationPos;

if (_eventType == 1 || _eventType == 3 || _eventType == 4) then {
	_mrkEnemy = createMarker ["mrkWarzoneEnemy", _eventLocationPos];
	_mrkEnemy setMarkerText "!!WARNING!! KEEP CLEAR";
	_mrkEnemy setMarkerShape "ICON";
	_mrkEnemy setMarkerColor "ColorEAST";
	_mrkEnemy setMarkerType "mil_warning";

	_mrkFriendlyPos = _eventLocationPos getPos [200 * sqrt random 1, random 360];
	_mrkFriendly = createMarker ["mrkWarzoneFriendly", _mrkFriendlyPos];
	_mrkFriendly setMarkerShape "ICON";
	_mrkFriendlyDir = [_mrkFriendlyPos, _eventLocationPos] call BIS_fnc_DirTo;
	_mrkFriendly setMarkerDir _mrkFriendlyDir;
	_mrkFriendly setMarkerColor "ColorWEST";
	_mrkFriendly setMarkerType "mil_arrow2";
};


_objPos = _eventLocationPos getPos [100 * sqrt random 1, random 360];
//_Obj1 = "land_helipadempty_f" createVehicle _objPos;
//nul = [_Obj1] execVM "RandFramework\Alias\ALambientbattle\alias_flaks.sqf"; 

/*if (selectRandom[true,false] || _eventType == 1 || _eventType == 4) then {
	_objPos = _eventLocationPos getPos [100 * sqrt random 1, random 360];
	_Obj8  = "land_helipadempty_f" createVehicle _objPos;
	null = [_Obj8,false] execVM "RandFramework\Alias\ALambientbattle\aaa_search_light.sqf";

	_objPos = _eventLocationPos getPos [100 * sqrt random 1, random 360];
	_Obj9  = "land_helipadempty_f" createVehicle _objPos;
	null = [_Obj9,false] execVM "RandFramework\Alias\ALambientbattle\aaa_search_light.sqf";	
};*/
if (selectRandom[true,false] || _eventType == 1 || _eventType == 4) then {
	_flatPos1 =  _eventLocationPos getPos [100 * sqrt random 1, random 360];
	_flatPos1 = [_eventLocationPos , 0, 100, 8, 0, 0.5, 0,[],[_flatPos1,_flatPos1]] call BIS_fnc_findSafePos;
	tracer1 setPos _flatPos1;

	_flatPos2 =  _eventLocationPos getPos [100 * sqrt random 1, random 360];
	_flatPos2 = [_eventLocationPos , 0, 100, 8, 0, 0.5, 0,[],[_flatPos2,_flatPos2]] call BIS_fnc_findSafePos;
	tracer2 setPos _flatPos2;

	_flatPos3 =  _eventLocationPos getPos [100 * sqrt random 1, random 360];
	_flatPos3 = [_eventLocationPos , 0, 100, 8, 0, 0.5, 0,[],[_flatPos3,_flatPos3]] call BIS_fnc_findSafePos;
	tracer3 setPos _flatPos3;

	_flatPos4 =  _eventLocationPos getPos [100 * sqrt random 1, random 360];
	_flatPos4 = [_eventLocationPos , 0, 100, 8, 0, 0.5, 0,[],[_flatPos4,_flatPos4]] call BIS_fnc_findSafePos;
	tracer4 setPos _flatPos4;

};

_mainAOPos = ObjectivePossitions select 0;

if (_eventType == 1 || _eventType == 2) then {
	//_objPos = _mainAOPos getPos [100 * sqrt random 1, random 360];
	//_Obj10  = "land_helipadempty_f" createVehicle _objPos;
	//nul = [_Obj10] execVM "RandFramework\Alias\ALambientbattle\alias_flaks.sqf"; 
};

/*
WarColor = ppEffectCreate ["colorCorrections", 1550];
//WarColor ppEffectAdjust [1, 0.8, -0.001, [0.0, 0.0, 0.0, 0.0], [0.8*2, 0.5*2, 0.0, 0.7], [0.9, 0.9, 0.9, 0.0]];  
WarColor ppEffectAdjust [1, 0.8, -0.001, [0.0, 0.0, 0.0, 0.0], [0.8*2, 0.5*2, 0.0, 0.92], [0.9, 0.9, 0.9, 0.0]];   
WarColor ppEffectCommit 0;
WarColor ppEffectCommit 0;

WarGrain = ppEffectCreate ["FilmGrain", 2050];
WarGrain ppEffectEnable true; 
WarGrain ppEffectAdjust [0.02, 1, 1, 0.1, 1, false];
WarGrain ppEffectCommit 0;

WarColor ppEffectEnable true;
WarGrain ppEffectEnable true;
*/

WarEventActive = true;

[_eventLocationPos] spawn {
	_eventLocationPos = _this select 0;
	while {WarEventActive} do {
		_type = selectRandom ["Bomb_03_F","Missile_AA_04_F","M_Mo_82mm_AT_LG"];
		_xPos = (_eventLocationPos select 0)-125;
		_yPos = (_eventLocationPos select 1)-125;


		if (selectRandom[true,false]) then {
			_li_aaa = _type createVehicleLocal [_xPos+(random 250),_yPos+(random 250),0];
			_li_aaa setDamage 1;
		}
		else {

			_group = createGroup east;
			_sUnitType = selectRandom [sRiflemanToUse,sMachineGunManToUse];
			_tempFireUnit = _group createUnit [_sUnitType,[_xPos+(random 250),_yPos+(random 250),0],[],0,"NONE"];
			hideObject _tempFireUnit;  
			sleep 1;
			_shotsToFire = selectRandom[3,10,15];
			_weapon = currentWeapon _tempFireUnit;
			_ammo = _tempFireUnit ammo _weapon;
			while {_shotsToFire > 0} do {
				_tempFireUnit forceWeaponFire [_weapon, "FullAuto"];
				_shotsToFire = _shotsToFire - 1;
				sleep 0.1;
			};
		
			deleteVehicle _tempFireUnit;
		};

		_sleep = 1+(random 6);
		_diceRoll = floor(random 12)+1;

		if (_diceRoll == 1) then {_sleep = 10+random 5};
		if (_diceRoll > 8) then {_sleep = 0.5+random 1};
		//hint str(_sleep);

		sleep _sleep;
	  };
};

[_eventLocationPos] spawn {
	_eventLocationPos = _this select 0;

	while {WarEventActive} do {

		waitUntil {bAndSoItBegins && CustomObjectsSet && PlayersHaveLeftStartingArea};

		_AirToUse = selectRandom FriendlyJet;
		_NoOfVeh = selectRandom [1,2];
		_bSetCaptive = selectRandom [true,true,true,false];
		if (selectRandom [true,false,false]) then {
			_AirToUse = selectRandom FriendlyChopper;
		};
		_pos = _eventLocationPos getPos [3000,random 360];//random 360 and 3 clicks out and no playable units within 2 clicks
		_pos = [_pos select 0,_pos select 1, 365];
		_dir = [_pos, _eventLocationPos] call BIS_fnc_DirTo;//dir from pos to _eventLocationPos
		_WarzoneGroupp1 = createGroup west;
		_WarZoneAir1 = [_pos, _dir, _AirToUse, _WarzoneGroupp1] call Bis_fnc_spawnvehicle;	
		(_WarZoneAir1 select 0) flyInHeight 45;
		(_WarZoneAir1 select 0) setBehaviour "CARELESS";
		(_WarZoneAir1 select 0) setSpeedMode "FULL";
		(_WarZoneAir1 select 0) doMove (_pos getPos [60000,_dir]);
		(_WarZoneAir1 select 0) setCaptive _bSetCaptive;
		_WarZoneAir2 = nil;
		if (_NoOfVeh > 1) then {
			_pos2 = _pos getPos [30,random 360];
			_WarZoneAir2 = [_pos2, _dir, _AirToUse, _WarzoneGroupp1] call Bis_fnc_spawnvehicle;	
			(_WarZoneAir2 select 0) flyInHeight 45;
			(_WarZoneAir2 select 0) setBehaviour "CARELESS";
			(_WarZoneAir2 select 0) setSpeedMode "FULL";
			(_WarZoneAir2 select 0) doMove (_pos getPos [60000,_dir]);
			(_WarZoneAir2 select 0) setCaptive _bSetCaptive;
		};
		
		[(_WarZoneAir1 select 0),_eventLocationPos] spawn {
			_veh = _this select 0;
			_eventLocationPos = _this select 1;
			while {alive _veh} do {
				_curDist = _veh distance _eventLocationPos;
				if (_curDist > 4000) then {
					{_veh deleteVehicleCrew _x} forEach crew _veh;
					deleteVehicle _veh;			
				};
			};
		};

		if (_NoOfVeh > 1) then {
			[(_WarZoneAir2 select 0),_eventLocationPos] spawn {
				_veh = _this select 0;
				_eventLocationPos = _this select 1;
				while {alive _veh} do {
					_curDist = _veh distance _eventLocationPos;
					if (_curDist > 4000) then {
						{_veh deleteVehicleCrew _x} forEach crew _veh;
						deleteVehicle _veh;			
					};
				};
			};
		};
		
		sleep selectRandom [60,80,100,120];
		
	};
};



/*
{nul = [99999,true] execvm "RandFramework\RikoSandStorm\ROSSandstorm.sqf";} remoteExec ["bis_fnc_call", 0];
*/

/*
 	WarColor ppEffectEnable false;
 	ppEffectDestroy WarColor;

    WarGrain ppEffectEnable false;
    ppEffectDestroy WarGrain;
*/


